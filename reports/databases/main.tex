%!TEX root = ../thesis.tex
%!TEX TS-program = lualatex
% vim:fenc=utf-8
% vim:fdm=marker



% preambulo latex 
\documentclass[11pt]{article}
\usepackage[spanish,es-lcroman,es-nodecimaldot]{babel}
\usepackage{amsmath,amsfonts,amssymb,units,xcolor}
\usepackage{graphicx,tabularx}
\usepackage{booktabs}
\usepackage{multirow}
\usepackage{fancyhdr}
\usepackage{hyperref}
\usepackage{blindtext}
\usepackage{lastpage}
\usepackage{fontspec}\usepackage{titlesec}
\usepackage[export]{adjustbox}
\usepackage[letterpaper,left=3cm,right=2cm,top=2cm,bottom=2cm]{geometry}
\usepackage[sort&compress,authoryear]{natbib}
\usepackage[justification=centerlast,labelfont=bf,font=scriptsize,
            margin=1.5cm,labelsep=period]{caption}


% definir variables
% -----------------
%\newcommand{\bomm}{BOMM1-ITS}


% configuracion de los paquetes
% -----------------------------

% configuracion de la fuente
\DeclareTextFontCommand{\emph}{\slshape}
\renewcommand\familydefault{\sfdefault}

% espaciado de las lineas para las págines iniciales
\renewcommand{\baselinestretch}{1.25} 
\setlength{\parindent}{0mm}
\setlength{\parskip}{2.5mm}

% hipervinculos
\hypersetup{%
    colorlinks,
    linkcolor={red!50!black},
    citecolor={blue!50!black},
    urlcolor={blue!80!black}
    }

% encabezado
\pagestyle{fancy}
\lhead{\includegraphics[height=0.75cm,valign=c]{./logo_cicese.jpg}\vspace{1pt}}
\chead{}
\rhead{Pág. \thepage/\pageref{LastPage}}
\lfoot{}
\cfoot{}
\rfoot{}
\renewcommand{\footrulewidth}{0.4pt}

% pagina de titulo
\title{
  \vspace{2em}
  \Large{\bfseries Reporte Técnico} \\
  \vspace{3em}
  \LARGE{\bfseries
    Base de datos de las observaciones de las Boyas Oceanográficas y de
    Meteorología Marina (BOMM)
  } \\
  \vspace{3em}
}
%
\author{
  \includegraphics[height=2cm,valign=c]{./logo_cicese.jpg} \\
  \vspace{0.5ex} \\
  Grupo de Oleaje \\
  \small{Departamento de Oceanografía Física} \\
  \small{Centro de Investigación Científica y de Educación Superior} \\
  \small{Ensenada, B.C., México} \\
  \vspace{2em} \\
}
\date{
  \today \\
  Elaboró: D.S.P. Zapata \\
  Revisión 2.0
  \vspace{2em} \\
  \begin{figure}
    \centering
    \includegraphics[height=2.1cm,valign=c]{./logo_cigom.jpeg}
    \hspace{0.5cm}
    \includegraphics[height=2.3cm,valign=c]{./logo_sener.jpg}
  \end{figure}
  \vfill
}


%  empezar documento    
% =============================================================================
\begin{document}

% crear titulo
\maketitle
\thispagestyle{empty}
\newpage
\thispagestyle{fancy}
\tableofcontents
\newpage

% introduccion {{{
\section{Introducción}
\label{sec:introduccion}

En este reporte técnico se presenta una descripción detallada del conjunto de
datos observados con las Boyas Oceanográficas y de Meterología Marina (BOMM).


% niveles de procesamiento {{{
\subsection{Niveles de procesamiento}
\label{sub:niveles_de_procesamiento}

Para los fines de este trabajo, se definieron tres niveles de procesamiento,
los cuales se describen a continuación:

\begin{description}
  \item[Nivel 0] En este nivel están los datos binarios que se escriben en la
    memoria interna de los instrumentos y los datos que son transmitidos a
    través de comunicación entre los instrumentos y la computadora de la boya.
    Estos datos están en formato ASCII y no tienen ningún control de
    calidad ni metadatos incorporados.

  \item[Nivel 1] El primer nivel de procesamiento consiste en generar la base de
    datos en formato netCDF4 a partir de los datos de Nivel 0. Se hace una
    acomodación de los datos en una secuencia creciente del tiempo de acuerdo a
    su tasa de muestreo. Adicionalmente, se llenan los espacios vacíos con
    banderas de datos no válidos (NaN). Se incorporan los metadatos e
    información adicional para realizar correcciones y calibraciones.
    \textbf{Ejemplos:} \emph{aceleraciones y tasas de cambio de los ángulos en el
    marco de referencia del sensor de movimiento, velocidad del viento sin
    corregir por el movimiento de la boya, posición de los WaveStaff para el
    cálculo de los espectros direccionales.}

  \item[Nivel 2] En este nivel se presentan las variables resultantes de agrupar
    y combinar los datos en un tiempo determinado (30 minutos). Específicamente,
    se presentan promedios de las variables provenientes de diferentes sensores.
    Se aplican métodologías establecidas para el cálculo de variables derivadas.
    \textbf{Ejemplos:} \emph{espectros direccionales, esfuerzos de Reynolds,
    rapidez y dirección del viento, parametros integrales del oleaje, etc.}

\end{description}

% }}}

% estructura de los archivos {{{
\subsection{Estructura de los archivos}
\label{sub:estructura_de_los_archivos}

Los datos están organizados de la siguiente manera: dentro de la carpeta
\texttt{data} hay una carpeta por cada instalación, por ejemplo, la BOMM1 que se
instaló cerca de la Isla Todos Santos, tiene el nombre de
\texttt{bomm1\_its}. Dentro de esta carpeta hay tres carpetas más con los datos
de cada nivel. Más detalles se presentan en la siguiente sección.


\begin{verbatim}
  ./data/
  |-- bomm1_its
  |   |-- level0
  |   |-- level1
  |   `-- level2
  |   ....
  |    
  `-- bomm2_its
      |-- level0
      |-- level1
      `-- level2
\end{verbatim}
% }}}

% archivos en netcdf {{{
\subsection{Formato NetCDF}
\label{sub:formato_netcdf}

Según el SMID de CIGOM (\url{http://smid.cigom.org/smid-docs/}), en la Línea 1
del proyecto se estableció que la entrega de conjuntos de datos será en formato
NetCDF ya que es un formato ampliamente utilizado por la comunidad científica y
además es compatible con una gran variedad de software de análisis y
visualización. NetCDF (\emph{Network Common Data Form}) es un conjunto de
bibliotecas de software y estándares de formato de datos, el cual es
independiente de la arquitectura de la máquina, es de código abierto, y permite
la creación, acceso y distribución de datos cientificos orientados a arreglos.
Una de sus mayores ventajas es que es autodescriptivo, es decir, los archivos
contienen los datos y los metadatos. Otra de sus ventajas es la portabilidad y
la escalabilidad, que permiten una fácil distribución y el acceso a subconjuntos
más pequeños de los datos que están alojados en un servidor remoto.
Específicamente la versión 4 del formato NetCDF permite la separación de los
datos en grupos, lo cual es muy útil cuando se trabajan con datos de diferentes
sensores y medidos a diferentes tasas de muestreo en el mismo dataset, como es
el caso de los datos de las boyas oceanográficas.


% }}}

% }}}

% descripción de la base de datos {{{
\section{Descripción de la base de datos}%
\label{sec:descripcion_de_la_base_de_datos}

% datos de nivel 0 {{{
\subsection{Nivel 0} 
\label{sub:nivel_0}

Se consideran como datos crudos los datos que se escriben directamente en el
disco duro de la boya. Estos datos no tiene ningún tipo de procesamiento, y se
escriben tal cual como salen de cada uno de los sensores.  Los datos crudos son
los datos de Nivel 0 y tienen la siguiente estructura:

\begin{verbatim}
  {bomm_name}/
  |-- level0/
  |   |-- acelerometro/
  |   |-- anemometro/
  |   |-- binary/
  |   |-- gps/
  |   |-- marvi/
  |   |-- maximet/
  |   |-- msg/
  |   |-- proceanus/
  |   |-- rbr/
  |   |-- signature/
  |   |-- vector/
  |   `-- wstaff/
  |-- level1/
  `-- level2/
\end{verbatim}

Se genera una carpeta por cada sensor. En la mayoría de los sensores (los de alta
frecuencia) se escribe una carpeta por año, una por mes, una por por día y una por
hora; y se escribe un archivo cada 10 minutos. Por ejemplo, la ruta del archivo que
corresponde a las 10:20 am del 5 de enero de 2018 del anemómetro sónico
instalado en la BOMM1-ITS es:

\begin{verbatim}
  ./data/bomm1_its/level0/anemometro/2018/01/05/10/anemometro-1801051020.csv
\end{verbatim}

Por otra lado, los sensores de baja frecuencia, es decir, los que reportan
promedios de los datos, como el sensor de CO2 y el CTD, se escribe una carpeta
por año y una carpeta por mes, y se escribe un archivo por día, el cual contiene
los datos a la tasa de muestreo específica.

En la carpeta \texttt{binary} se almacenan los archivos binarios originales de
los sensores que así lo permiten. Por ejmplo, en el caso de la BOMM1-ITS que
estuvo midiendo cerca de la Isla de Todos Santos, entre noviembre de 2017 y
febrero de 2018, los sensores que permitieron almacenar los datos binarios
fueron el acelerómetro (Ekinox2-M), el MARVI (Módulo de Adquisición y Regulación
de Voltaje Inteligente) y el velocímetro Vector. En la carpeta \texttt{msg} se
almacenan los promedios de los datos que son enviados vía satélite. En las
carpetas \texttt{level1}, \texttt{level2} y \texttt{level3} se almacenan los
datos procesados en los diferentes niveles, los cuales se describen en las
siguientes secciones.
% }}}

% datos de nivel 1 {{{
\subsection{Nivel 1}
\label{sub:nivel_1}

\subsubsection*{Análisis de los datos}

Se realizó un análisis y procesamiento de los datos crudos para convertirlos al
formato netCDF. Para esto, primero se hace una acomodación de los datos en una
secuencia creciente de tiempo de acuerdo a su tasa de muestreo. Por ejemplo,
algunos sensores presentan imprecisiones en su reloj interno, lo que implica que
la tasa de muestreo a la que se programan no sea constante en el tiempo lo cual
genera pequeñas variaciones, que hacen que en ocasiones se tengan más o menos
datos de los que se esperan en cierto intervalo de tiempo. Por ejemplo, los
alambres de capacitancia se programan para medir a una tasa de muestreo de 20
datos por segundo, pero debido a la deriva del reloj, en ocasiones se tiene 19 o
21 datos en un segundo. Para solucionar esto, se genera una arreglo del tiempo
de acuerdo a la tasa de muestreo del instrumento y se aplica una interpolación
lineal de los datos. Si hay más del 10\% de datos inválidos de forma continua
dentro de un intervalo de 10 minutos, ese intervalo se considera como inválido.
Cuando son menos de 10\% los datos inválidos y estos no están de forma continua
en el tiempo, los datos inválidos se reemplazan por promedios del intervalo de
10 minutos con el fin de aplicar la interpolación.  Finalmente, cuando se tiene
espacios vacíos, es decir, intervalos de tiempo donde la boya no registró datos,
se genera un arreglo con datos no válidos (NaN) del mismo tamaño y se llenan
dichos espacios vacíos. En los datos de Nivel 1 se eliminan también los datos en
los que la boya no estaba instalada. Estos datos si se conservan en el Nivel 0.


\subsubsection*{Estructura de los archivos}%

Los datos de Nivel 1 de procesamiento se escriben en archivos netCDF4, usando la
capacidad de generar grupos de datos, característica de este formato. Se genera
un archivo netCDF4 por cada día de datos. El nombre cada archivo consiste en la
fecha en el formato \texttt{'yyyymmdd'} más la extensión \text{'.nc'}, por
ejemplo:

\begin{verbatim}
  level1/
    |-- 20171117.nc
    |-- 20171118.nc
    |-- 20171119.nc
    |--     .
    |--     .
    |--     .
    |-- 20180131.nc
    `-- 20180201.nc
\end{verbatim}


Cada archivo agrupa los datos en grupos por cada sensor. Por ejemplo, los datos
de la BOMM1-ITS se clasifican en los siguientes grupos.

\begin{verbatim}
  groups: ekinox, sonic, gps, marvi, maximet, proceanus,
          rbr, signature, vector, wstaff
\end{verbatim}

Los grupos contienen las variables y las dimensiones. En este caso solo se tiene
dos tipos de dimensiones, el tiempo y el número de celdas, esta última es
exclusiva del perfilador de corrientes Signature 1000 kHz. El siguiente es un
ejemplo de la estructura del grupo asociado con los datos del sensor de
movimiento Ekinox2-M:

\begin{verbatim}
  group /ekinox:
      sampling_frequency: 100
      serial_number: 5242914
      description: MRU Subsea Ekinox2-M
      convention: X positive towards north buoy, Y eastward and Z downward
      dimensions(sizes): time(8640000)
      variables(dimensions): float64 time(time), float64 accel_x(time),
                             float64 accel_y(time), float64 accel_z(time),
                             float64 gyro_x(time), float64 gyro_y(time),
                             float64 gyro_z(time), float64 delta_vel_x(time),
                             float64 delta_vel_y(time), float64 delta_vel_z(time),
                             float64 delta_ang_x(time), float64 delta_ang_y(time),
                             float64 delta_ang_z(time), float64 temp(time)
\end{verbatim}

Cada una de las variables tiene atributos, para los cuales se sigue la
convención CF-1.7 y las recomendaciones de los manuales de usuario de cada uno
de los instrumentos. Por ejemplo, los atributos de la tasa de cambio del ángulo
al rededor del eje $x$, se presentan a continuación:

\begin{verbatim}
  float64 gyro_x(time)
      _FillValue: nan
      standard_name: gyro_x
      long_name: rate of change of the angle in X direction
      units: rad/s
  path = /ekinox
  unlimited dimensions:
  current shape = (8640000,)
  filling on
\end{verbatim}

Los metadatos de las mediciones que se incorporan en el archivo netCDF se
presentan en un archivo aparte con un formato YAML (\url{http://yaml.org/}) ya
que es el formato más amigable para este tipo de información. Por ejemplo, los
atributos globales que identifican la información de la boya son:

\begin{verbatim}
title: BOMM1-ITS observations from Nov 2017 to Jan 2018.

summary: >
  This dataset presents air-sea physical and chemical variables from an
  Oceanographic and Marine Meteorology buoy (BOMM) near the Isla Todos
  Santos, Ensenada, BC, México, from Nov 2017 to Jan 2018. This dataset
  is part of the BOMM observations test period.

keywords: >
  air-sea momentum flux, air-sea carbon exchange, directional wave spectrum,
  oceanographic buoy, wave parameters.

comments: >
  The BOMM1-ITS was deployed on 2017/11/16 and recovered on 2018/02/02.

institution: CICESE - CIGOM
date_created: 2019/01/26
creator_name: The waves group - CICESE
creator_url: https://www.cicese.mx/
creator_email: oleaje@cigom.org
acknowledgments: >
  This research has been funded by Fondo Sectorial CONACYT-SENER
  Hidrocarburos, Project 201441.

references: |
  Anctil, Donelan, Drennan, Graber, (1994). JAOT 11(4):1144–1150.
  Donelan, Drennan, Magnusson, (1996). JPO, 26(9):1901–1914.
  Ocampo-Torres, García-Nava, Durazo, Osuna, Méndez, Graber, (2010).
    BLM, 138(3):433–451.

convention: CF-1.7
\end{verbatim}

Igualmente, en el formato YAML se presentan los metadatos asociados con los
atributos de cada variable. Para esto se separan en grupos de acuerdo con cada
sensor como se muestra a continuación:

\begin{verbatim}
  ekinox:
    sampling_frequency: 100
    seconds_per_file: 600
    serial_number : 024000042
    description: MRU Subsea Ekinox2-M
    convention: X positive towards north buoy, Y eastward and Z downward
    variables:
      accel_x:
        column: 6
        long_name: acceleration in X direction
        units: m/s^2
      accel_y:
        column: 7
        long_name: acceleration in Y direction
        units: m/s^2
        .
        .
        .
      delta_ang_z:
        column: 18
        long_name: coning output in Z direction
        units: rad/s
      temp:
        column: 15
        long_name: sensor temperature
        units: degrees_celsius
\end{verbatim}

En este caso, los metadatos son los mismos que se escribieron en el archivo
NetCDF, excepto por algunos como \texttt{column} que es el número de la columna
en la que se presentan los datos en el archivo ASCII del Nivel 0.


\subsubsection*{Ejemplo de acceso a los datos}
\label{ssub:ejemplos_de_acceso_a_los_datos}

Los archivos netCDF4 son de fácil acceso en la mayoría de los lenguajes de
programación, por ejemplo, en Python se usa la paquetería
\texttt{netcdf4-python} (\url{http://unidata.github.io/netcdf4-python/}). A
continuación se presenta un ejemplo simple de cómo leer los datos de Nivel 1 en
Python 3.6.5:

\begin{verbatim}
  import numpy as np
  import netCDF4 as nc
  #
  filename = "../data/20171117.nc" 
  data = nc.Dataset(filename) #<-- carga el dataset completo
  ekx = data["ekinox"]        #<-- lee el grupo del ekinox
  met = data["maximet"]       #<-- lee el grupo de la maximet
  #
  i, j = 0, 180000            #<-- indices para el tiempo 30 mins
  ax = ekx["accel_x"][i:j]    #<-- extrae la aceleracion en x
\end{verbatim}



% }}}

% datos de nivel 2 {{{
\subsection{Nivel 2}
\label{sub:nivel_2}

Los datos de Nivel 2 consisten en promedios de 30 minutos de las variables
físicas más importantes derivadas de las observaciones del Nivel 1. Estos datos
se encuentran en un solo archivo netCDF4. Las variables que se tiene en este
nivel se describen a continuación en la Tab.~\ref{tab:variables_nivel2}:

\begin{table}[htpb]
  \scriptsize
  \centering
  \caption{Descripción de las variables presentes en el Nivel 2.}
  \label{tab:variables_nivel2}
  \begin{tabular}{l l l}
    \toprule
    Variable & Nombre & Unidades \\
    \midrule
    \texttt{roll} & Inclinación adelante/atrás & grados \\
    \texttt{pitch} & Inclinación izquierda/derecha & grados \\
    \texttt{heading} & Orientación & grados \\
    \texttt{tWdir} & Dirección del real viento & grados \\
    \texttt{rWdir} & Dirección del relativa del viento & grados \\
    \texttt{Wspd} & Rapidez del viento en el mástil & m/s \\
    \texttt{Pa} & Presión atmosférica & hPa \\
    \texttt{Ta} & Temperatura del aire & grados Celsius \\
    \texttt{rhum} & Humedad relativa del aire & \% \\
    \texttt{DP} & Temperatura del punto de rocío & grados Celsius \\
    \texttt{total rain} & Precipitación total & mm \\
    \texttt{rain rate} & Intensidad de la precipitación & mm/h \\
    \texttt{aCO2} & Concentración de CO2 en el aire & ppm \\
    \texttt{wCO2} & Concentración de CO2 en el agua & ppm \\
    \texttt{ahum} & Humedad absoluta del aire & mbar \\
    \texttt{rhoa} & Densidad del aire & kg/m$^3$ \\
    \texttt{lat} & Latitud & grados norte \\
    \texttt{lon} & Longitud & grados este \\
    \texttt{pH} & pH del agua de mar & units \\
    \texttt{Sw} & Salinid del agua & ppm \\
    \texttt{Tw} & Temperatura del agua & grados Celsius \\
    \texttt{Cw} & Conductividad del agua & mS/cm \\
    \texttt{rhow} & Densidad in-situ del agua & kg/m$^3$ \\
    \texttt{depth} & Profundidad & m \\
    \texttt{dissoxy} & Oxígeno disuelto & \% \\
    \texttt{S} & Espectro en frecuencia del oleaje & m$^2$/Hz \\
    \texttt{E} & Espectro direccional del oleaje & m$^2$/Hz/rad \\
    \texttt{Hm0} & Altura significante del oleaje & m \\
    \texttt{Tp} & Período del pico espectral & s \\
    \texttt{pDir} & Dirección del pico espectral & grados \\
    \texttt{mDir} & Dirección promedio del oleaje & grados \\
    \texttt{Us0} & Magnitud de la deriva de Stokes en la superficie & m/s \\
    \texttt{Ua} & Componente zonal del viento & m/s \\
    \texttt{Va} & Componente meridional del viento & m/s \\
    \texttt{Ts} & Temperatura sónica & grados Celsius \\
    \texttt{uw} & Flujo de momentum zonal & m$^2$/s$^2$ \\
    \texttt{vw} & Flujo de momentum meridional & m$^2$/s$^2$ \\
    \texttt{wT} & Flujo de calor sensible & K$\;$m/ s \\
    \texttt{ustar} & Velocidad de fricción en el aire & m/s \\
    \texttt{wstar} & Velocidad de fricción en el agua & m/s \\
    \texttt{U10N} & Rapidez del viento a 10 m en condiciones neutrales & m/s \\
    \texttt{v1} & Componente $v_1$ de la velocidad del agua & m/s \\
    \texttt{v2} & Componente $v_2$ de la velocidad del agua & m/s \\
    \texttt{v3} & Componente $v_3$ de la velocidad del agua & m/s \\
    \texttt{vel b1} & Perfil de la velocidad en la columna - Haz 1 & m/s \\
    \texttt{vel b2} & Perfil de la velocidad en la columna - Haz 2 & m/s \\
    \texttt{vel b3} & Perfil de la velocidad en la columna - Haz 3 & m/s \\
    \texttt{vel b5} & Perfil de la velocidad en la columna - Haz 5 & m/s \\
    \texttt{Ti} & Temperatura interna del cilindro & grados Celsius \\
    \texttt{Pi} & Presión interna del cilindro & mbar \\
    \texttt{Hi} & Humedad interna del cilindro & \% \\
    \bottomrule
  \end{tabular}
\end{table}


Los atributos globales del archivo del Nivel 2 son los mismos que los de los
archivos de Nivel 1. En este caso se definieron 6 dimensiones. La más importante
es el tiempo ya que todas las variables dependen del tiempo. Luego está el
número de alambres de capacitancia (6) y las frecuencias del espectro en
frecuencias, las frecuencias y direcciones del espectro direccional y por
último las profundidades del perfil de corrientes que mide el Signature 1000
kHz. Un ejemplo de cómo se ven los atributos de cada una de las dimensiones se
muestra a continuación:

\begin{verbatim}
  dimensions:
        time = 3648 ;
        nwstaff = 6 ;
        ffrq = 1801 ;
        wfrq = 97 ;
        dirs = 360 ;
        z_profile = 10 ;
  variables:
        double time(time) ;
                time:units = "seconds since 1970-01-01 00:00:00" ;
                time:calendar = "gregorian" ;
        double nwstaff(nwstaff) ;
        double ffrq(ffrq) ;
        double wfrq(wfrq) ;
        double dirs(dirs) ;
        double z_profile(z_profile) ;
        ...
\end{verbatim}

Cada una de las variables en el archivo tiene los siguientes atributos:
\begin{description}
  \item[\textbf{\texttt{\_FillValue}:}]
    Valor que se usa como bandera para designar a los datos faltantes. En este
    caso se usa \texttt{NaN} (Not a Number), que es el estándar del IEEE 754.

  \item[\textbf{\texttt{standard\_name}:}]
    En este atributo va el nombre estándar de la variable. Para acercarse lo más
    posible a un nombre estándar se usaron las recomendaciones de la convención
    C.F. 1.7 y además los nombres que designan los fabricantes a las variables
    de cada sensor. 

  \item[\textbf{\texttt{long\_name}:}]
    Aquí va una descripción más detallada del nombre de la variables.

  \item[\textbf{\texttt{units}:}]
    Las unidades de la variable en formato de texto compatible.

  \item[\textbf{\texttt{source}:}]
    En este campo va la fuente de dónde se obtuvieron los datos para calcular
    las variables. Como todas las variables del Nivel provienen de las variables
    de Nivel 1, entonces en este atributo se puso el nombre del sensor del que
    se obtuvo la variable.

  \item[\textbf{\texttt{valid\_range}:}]
    Este atributo contiene una lista de dos elementos con los valores mínimos y
    máximos posibles que podría tomar la variables para que sea considerada como
    válido. Los valores por fuera del éste rango son automáticamente
    descartados. Este campo es bastante útil como primer criterio de depuración
    de los datos.

  \item[\textbf{\texttt{dimensions}:}]
    En este atributo van las dimensiones de las que depende las variables. Por
    ejemplo en el caso de la rapidez del viento, la dimensión es solo el tiempo,
    pero en el caso del espectro direccional del oleaje, las dimensiones son
    tiempo, frecuencia y dirección.

\end{description}


Un ejemplo de cómo se ven los atributos del flujo de calor sensible sería:

\begin{verbatim}
       double wT(time) ;
              wT:_FillValue = NaN ;
              wT:standard_name = "upward_sensible_heat_flux" ;
              wT:long_name = "upward sensible heat flux" ;
              wT:units = "Km/ s" ;
              wT:source = "sonic anemometer" ;
              wT:valid_range = -1LL, 1LL ;
              wT:dimensions = "time" ; 
\end{verbatim}


%TODO: Las consideraciones más importantes que se tuvieron en cuenta, como se
%calcularon las variables, espectros y demás y el disclaimer.


% }}}


% }}}

% procesamiento de los datos {{{
\section{Procesamiento de los datos}
\label{sec:proceamiento_de_los_datos}

En esta sección se hace una descripción del procedimiento llevado a cabo para la
generación de los datos del segundo nivel de procesamiento. Se explican los
métodos y algunas consideraciones.

\subsubsection*{Parámetros del oleaje}%
\label{ssub:parametros_del_oleaje}

El cálculo del espectro direccional del oleaje permite la estimación de
diferentes parámetros. En este caso se calcularon los principales. La altura
significante del oleaje se estimó como:

\begin{equation}
  H_{m0} = 4 \left[ \iint E(f, \theta) d\theta df \right]^{1/2},
\end{equation}

esta es una medida directa de la energía de las olas. Igualmente, el período
asociado al pico espectral y su dirección se calcularon usando una estimación
robusta para evitar la dependencia de la resolución espectral:

\begin{equation}
  T_{p} = \frac{{\displaystyle \int} S(f)^4 df}{{\displaystyle \int} f S(f)^4 df},
  \hspace{2em}
  \theta_{p} = \frac{{\displaystyle \int} \Theta(\theta)^4 d\theta}{{\displaystyle \int}
  \theta \Theta(\theta)^4 d\theta},
\end{equation}

donde $S(f)=\int{E(f, \theta)} d\theta$ y $\Theta(\theta) = \int{E(f,\theta)}
df$ son los espectros integrados en dirección y en frecuencia, respectivamente,
La dirección promedio del oleaje se calculó como:

\begin{equation}
  \overline{\theta} = \tan^{-1} \left\{ \frac{
                 {\displaystyle \iint E(f,\theta)\sin\theta} d\theta df}
                {{\displaystyle \iint E(f,\theta)\cos\theta } d\theta df}
                         \right\}.
\end{equation}

Otro de los parámetros más importantes del oleaje es la deriva de Stokes. En
este caso se calculó la deriva de Stokes en la superficie a partir del espectro
integrado en dirección como:

\begin{equation}
  U_{s}(z) = \frac{16 \pi^3}{g} \int f^3 S(f) e^{2kz} df.
\end{equation}

Una recomendación es que se calcule la deriva de Stokes a partir de las
componentes del espectro direcciones, es decir,
\begin{equation}
  \mathbf{U}_{s}(z) = U_s \mathbf{\hat{x}} + V_s \mathbf{\hat{y}}
\end{equation}

\begin{equation}
  \mathbf{U}_{s}(z) = \frac{16 \pi^3}{g} \left[
    \mathbf{\hat{x}} {\displaystyle \iint f^3 E(f,\theta)\cos\theta } e^{2kz} d\theta df + 
    \mathbf{\hat{y}} {\displaystyle \iint f^3 E(f,\theta)\sin\theta } e^{2kz} d\theta df
  \right]
\end{equation}

donde $\mathbf{\hat{x}}$ y $\mathbf{\hat{y}}$ representan los vectores unitarios
en el plano cartesiano.


\subsubsection*{Parámetros del flujo de momentum}%
\label{ssub:parametros_del_flujo_de_momentum}

El flujo de momentum entre el océano y la atmósfera se estima a partir de la
velocidad de fricción, la cual a su vez es calculada en función de las
fluctuaciones turbulentas de la velocidad del viento, que se miden con el
anemómetro sónico. En ese orden de ideas, lo primero que se hace es rotar el
sistema de coordenadas del anemómetro en la dirección del viento promedio de un
intervalo de 10 minutos (o 30 minutos). Con esto se garantiza que
$\overline{V}=\overline{W}=0$. El flujo de momentum en dirección del viento
promedio es entonces calculado a partir del esfuerzo de Reynolds en la misma
dirección, es decir, $\tau_x = -\rho_a \overline{u'w'}$. Análogamente, el
esfuerzo del viento en la dirección perpendicular es $\tau_y = -\rho_a
\overline{v'w'}$. Estas correlaciones se calcularon simplemente como:

\begin{equation}
  \overline{u'w'} = \frac{1}{N} \sum_{i=1}^{N} (U-\overline{U})(W-\overline{W}),
\end{equation}

y,

\begin{equation}
  \overline{v'w'} = \frac{1}{N} \sum_{i=1}^{N} (V-\overline{U})(W-\overline{W}).
\end{equation}

donde $N$ es el número de datos. La velocidad de fricción en el aire se calculó
como:

\begin{equation}
  u_\star = \left( \overline{u'w'}^2 + \overline{v'w'}^2 \right)^{1/4},
\end{equation}

y su análoga en el agua, considerando conservación del flujo momentum en la
interfase, como:

\begin{equation}
  w_\star =  u_\star \sqrt{\rho_a / \rho_w},
\end{equation}

donde $\rho_a$ representa la densidad del aire y $\rho_w$ la del agua, las
cuales fueron calculadas usando la ecuación de estado de TEOS10 implementada en
\texttt{python} (\url{http://www.github.com/TEOS-10/GWS-python})


\begin{equation}
  L = \frac{T_s u_\star^3}{\kappa g \overline{w'T'_s}}
\end{equation}

\begin{equation}
  U_{zN} = U_{6.5} + \frac{u_\star}{\kappa}  \Psi (z/L)
\end{equation}

\begin{equation}
  U_{10N} = U_{zN} + \frac{u_\star}{\kappa} \log\left(\frac{10}{z}\right)
\end{equation}


\citet{Hogstrom1988}

\begin{equation}
  %\Psi(z/L) = 
  \Psi(z/L) = \left\{
    \begin{array}{cc}
      (1 + 15.2 z/L)^{1/4}, & z/L < 0 \\
      1 + 4.8 z/L,          & z/L > 0
    \end{array}  
  \right.
\end{equation}



% }}}

% referencias {{{
\bibliographystyle{apalike}
\bibliography{./references.bib}
% }}}


\end{document}
%  finalizar documento --------------------------------------------------------
